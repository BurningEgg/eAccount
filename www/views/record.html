<% include header.html %>
<% include sidebar.html %>
<link href="css/lib/bootstrap-datetimepicker.css" type="text/css" rel="stylesheet" />
 <script src="js/bootstrap-datetimepicker.js"></script>
    <div class="content">
        <div class="container-fluid">
            <div id="pad-wrapper">
                <div class="table-wrapper">
                    <div class="row-fluid head">
                        <div class="span12">
                            <h4>Records</h4>
                        </div>
                    </div>
                    <div class="row-fluid filter-block">
                        <div class="pull-right" >
                            <div class="ui-select">
                                <select name="category-selector" class = "category-selector">
                                  
                                </select>
                            </div>
                            <input type="text" class="search" x-webkit-speech="x-webkit-speech" />
                            <a class="btn-flat success new-product" role="button" href="#addRecord" data-toggle="modal">+ Add Record</a>
                            <script>
                                $('#addRecord').ready(function() {
                                    $("#my-checkbox1").bootstrapSwitch()
                                    $('#datePicker1').datetimepicker({
                                                    weekStart: 1,
                                                    todayBtn:  1,
                                                    autoclose: 1,
                                                    todayHighlight: 1,
                                                    startView: 2,
                                                    forceParse: 0,
                                                    showMeridian: 1
                                                });
                                })
                                $('#editRecord').ready(function() {
                                    $("#my-checkbox2").bootstrapSwitch()
                                    $('#datePicker2').datetimepicker({
                                                    weekStart: 1,
                                                    todayBtn:  1,
                                                    autoclose: 1,
                                                    todayHighlight: 1,
                                                    startView: 2,
                                                    forceParse: 0,
                                                    showMeridian: 1
                                                });
                                })
                            </script>
                            <div id="addRecord" class="modal hide fade" role="dialog">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">Add Record</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="span8 column">
                                                <form action="/record/new" method="post">
                                                    <div class="field-box">
                                                        <label>Amount:</label>
                                                        $<input class="span3 add-amount" type="text" name="add-amount" />
                                                    </div>
                                                    <div class="field-box">
                                                        <input type="checkbox" id="my-checkbox1" name="type" checked />
                                                    </div>
                                                    <div class="field-box">
                                                        <label>Select:</label>
                                                        <div class="ui-select">
                                                            <select name="add-record-category" class = "add-record-category">
                                                                
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="field-box">
                                                        <label>Pick a date and time:</label>
                                                        <input type="text" id="datePicker1" class = "add-record-datepicker" value="" />
                                                    </div>
                                                    <div class="field-box">
                                                        <label>Description:</label>
                                                        <input class="span add-record-desc" type="text" name="desc" />
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal" >Cancel</button>
                                            <button type="button" class="btn btn-primary add-record-submit">Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th class="span2">
                                       <span>Date</span>
                                    </th>
                                    <th class="span2">
                                        <span>balance</span>
                                    </th>
                                    <th class="span2">
                                        <span>Amount</span>
                                    </th>
                                    <th class="span1">
                                        <span>Category</span>
                                    </th>
                                    <th class="span3">
                                        <span>Description</span>
                                    </th>
                                    <th class="span2">
                                    	<span>Operation</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="record-content">
                                <!-- row -->
                                <tr class="first">
                                    <td>
                                        <span>2014-05-01</span>
                                    </td>
                                    <td>
                                        <span class="dollar">55.8</span>
                                    </td>
                                    <td>
                                        <span class="label label-success dollar">18.6</span>
                                    </td>
                                    <td>
                                        <span>food</span>
                                    </td>
                                    <td class="description">
                                        <p>If you are going to use a passage of Lorem Ipsum.</p>
                                    </td>
                                    <td>
                                    	<ul class="actions">
                                            <li>
                                                <a href="#editRecord" title ="Edit" data-toggle="modal"><i class="table-edit"></i></a>
                                            </li>
                                            <li class="last"><a href="#deleteRecord" title="delete" data-toggle="modal"><i class="table-delete"></i></a>
                                                
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="editRecord" class="modal hide fade">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4 class="modal-title">Edit Record</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="span8 column">
                                            <form action="/record/new" method="post">
                                                <div class="field-box">
                                                    <label>Amount:</label>
                                                        $<input class="span3" type="text" name="amount" />
                                                </div>
                                                <div class="field-box">
                                                    <input type="checkbox" id="my-checkbox2" name="type" checked />
                                                </div>
                                                <div class="field-box">
                                                    <label>Select:</label>
                                                    <div class="ui-select">
                                                        <select name="edit-record-category" class="edit-record-category">
                                                                                    
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="field-box">
                                                    <label>Pick a date and time:</label>
                                                    <input type="text" id="datePicker2" value="" />
                                                </div>
                                                <div class="field-box">
                                                    <label>Description:</label>
                                                    <input class="span" type="text" name="desc" />
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal" >Cancel</button>
                                        <button type="button" class="btn btn-primary">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="deleteRecord" class="modal hide fade">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Delete Record</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="span8 column">
                                            <p>Are you sure you want delete this record</p>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal" >Cancel</button>
                                        <button type="button" class="btn btn-primary">Yes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pagination">
                      <ul>
                        <li><a href="#">&#8249;</a></li>
                        <li><a class="active" href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">&#8250;</a></li>
                      </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(function(){
            $.ajax({
                type: "GET",
                url: "/category/list",
                dataType: "json",
                success:function(msg){
                    console.log(msg);
                    if(msg.error){
                    
                    }else{
                        var content = "<option value = 'All Category'>All Category</option>";
                        var contentAddRecord = "";
                        for(var i = 0; i < msg.categoryList.length; i++){
                            content+="<option value = '"+msg.categoryList[i]+"'>"+msg.categoryList[i]+"</option>";
                            contentAddRecord+="<option value = '"+msg.categoryList[i]+"'>"+msg.categoryList[i]+"</option>";
                        }
                        $('.category-selector').html(content);
                        $('.add-record-category').html(contentAddRecord);
                        $('.edit-record-category').html(contentAddRecord);
                    }
                    
                }
            })
            
            $.ajax({
                type: "GET",
                url: "/record/list",
                dataType: "json",
                success: function(msg){
                    console.log(msg);
                    if(msg.error){
                    }else{
                    
                    var content = "";
                    for(var i = 0; i < msg.recordList.length; i++){
                        content+="<tr class='first'>";
                        content+="<td><span>"+msg.recordList[i].datetime+"</span></td>";
                        content+="<td><span class='dollar'>"+msg.recordList[i].amount+"</span></td>";
                        content+="<td><span class='label label-success dollar'>"+msg.recordList[i].amount+"</span></td>";
                        content+="<td><span>"+msg.recordList[i].category+"</span></td>";
                        content+="<td class='description'><p>"+msg.recordList[i].desc+"</p></td>";
                        content+="<td><ul class='actions'>";
                        content+="<li><a href='#editRecord' title ='Edit' data-toggle='modal'><i class='table-edit'></i></a></li>";
                        content+="<li class='last'><a href='#deleteRecord' title='delete' data-toggle='modal'><i class='table-delete'></i></a></li>";
                    }
                    $('#record-content').html(content);
                    }
                    
                }
            })
            
            $('.add-record-submit').click(function(){
                $.ajax({
                    type: "POST",
                    url: "record/new",
                    data: {amount:$('.add-amount').val(), category: $('select.add-record-category').val(), desc: $('.add-record-desc').val(), datetime: $('.add-record-datepicker').val()},
                    dataType: "json",
                    success:function(msg){
                        if(msg.error){
                            alert("error");
                        }else{
                            location.reload();
                        }
                    }
                })
            })
        })
    </script>

<% include footer.html %>